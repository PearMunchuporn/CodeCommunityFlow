@model List<CodeCommunityFlow.ViewModels.CommentFromAnnouncementViewModel>
@{
    ViewBag.Title = "Comments Management";
    Layout = "~/Areas/Admin/Views/Shared/_AdminViewLayout.cshtml";
}
@if (TempData["SuccessDeleteComment"] != null)
{
    <div class="alert alert-success" id="successAlert">@TempData["SuccessDeleteComment"]</div>
}

<h4 class="my-4">All Comments</h4>

<table id="commentsTable" class="table table-borderless table-hover">
    <thead>
        <tr>
            <th>Votes Count</th>

            <th>Comment</th>
            <th style="width:10%">Commented By</th>
            <th>Commented Date Time</th>
            <th>Delete Comment</th>

        </tr>
    </thead>

    <tbody>
        @foreach (var Model in Model) // Assume you're looping through a list
        {
            <tr>
                <td>

                    <span class="badge badge-customVoteCount">@Model.VoteCount </span>@(Model.VoteCount > 1 ? " Votes" : " Vote")
                </td>


                <td>
                    <b>
                        <a href="/Admin/AdminAnnouncement/ViewAnnouncement/@Model.AdminAnnouncementID">
                            @Model.CommentContent
                        </a>
                    </b>
                </td>

                <td>

                    @if (Model.Users?.UserID != null)
                    {
                        <p class="text-name">by @Model.Users.UserName</p>
                    }
                    else
                    {
                        <p class="text-name">by Deleted User</p>
                    }

                </td>
                <td class="text-muted">@Model.CommentDateTime</td>

                <td>

                    <button class="btn btn-sm btn-danger"
                            data-toggle="modal" data-target="#deleteCommentModal"
                            data-comment-id="@Model.CommentID">
                        Delete
                    </button>

                </td>
            </tr>
        }
    </tbody>
</table>



<!-- Delete Confirmation Modal -->

<div class="modal fade" id="deleteCommentModal" tabindex="-1" role="dialog" aria-labelledby="deleteModalLabel">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header bg-danger text-white">
                <h5 class="modal-title" id="deleteModalLabel">Confirm Delete</h5>
                <button type="button" class="close text-white" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                Are you sure you want to delete this comment?
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
                <a id="confirmDeleteBtn" href="#" class="btn btn-danger">Delete</a>
            </div>
        </div>
    </div>
</div>

<style>
    /* Base style */
    .dataTables_wrapper .dataTables_paginate .paginate_button {
        padding: 0.25rem 0.5rem !important;
        font-size: 0.875rem !important;
        margin: 0;
        border-radius: 0.25rem !important;
        color: #007bff !important;
        background: transparent !important;
        border: 1px solid transparent;
    }

        /* Current page */
        .dataTables_wrapper .dataTables_paginate .paginate_button.current {
            background-color: #007bff !important;
            color: #fff !important;
            border: 1px solid transparent;
        }

        /* Hover state override */
        .dataTables_wrapper .dataTables_paginate .paginate_button:hover,
        .dataTables_wrapper .dataTables_paginate .paginate_button:active,
        .dataTables_wrapper .dataTables_paginate .paginate_button:focus {
            background-color: #e2e6ea !important; /* Light gray */
            color: #007bff !important;
            border: 1px solid #dee2e6 !important;
            box-shadow: none !important;
        }
</style>



<!-- Bootstrap JS -->
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.6.2/js/bootstrap.bundle.min.js"></script>

<!-- DataTables core -->
<script src="https://cdn.datatables.net/1.10.21/js/jquery.dataTables.min.js"></script>

<!-- DataTables Bootstrap 4 integration -->
<script src="https://cdn.datatables.net/1.10.21/js/dataTables.bootstrap4.min.js"></script>

<script>


    $(document).ready(function () {
        var table = $('#commentsTable').DataTable({
            paging: true,
            ordering: true,
            info: true,
            pagingType: "full_numbers",
            columnDefs: [
                { orderable: false, targets: [4] }
            ],
            drawCallback: function () {
                // Rebind modal trigger on redraw
                $('[data-toggle="modal"]').off('click').on('click', function () {
                    var CommentId = $(this).data('comment-id');
                    var deleteUrl = '/Admin/CommentManagement/DeleteCommentByAdmin/' + CommentId;
                    $('#confirmDeleteBtn').attr('href', deleteUrl);
                    $('#deleteCommentModal').modal('show');
                });
            }
        });


        // Confirm delete button
        $(document).on('click', '#confirmDeleteBtn', function (e) {
            e.preventDefault();
            var deleteUrl = $(this).attr('href')
            if (deleteUrl) {
                window.location.href = deleteUrl
            }
        })
    })

    setTimeout(function () {
        var alert = document.getElementById("successAlert")
        if (alert) {
            alert.classList.remove("show")
            alert.classList.add("fade")
            alert.style.opacity = 0
            setTimeout(() => alert.remove(), 500) // remove from DOM after fade
        }
    }, 3000); // 3000ms
</script>

